import{r as t}from"./iframe-u-uZSGaK.js";import{m as we}from"./throttle-BIWfclFY.js";import{R as ve,S as he,u as ge}from"./image-window-loader-BuZ8WPKd.js";import{s as me}from"./marked.esm-DMz2Pe0E.js";function ce(e,u,v,o){return we(Math.round(u-(e.growOffset??0)),Math.ceil(v),Math.floor(o))}const Ce=e=>{const[u,v]=t.useState(),[o,b]=t.useState(),[s,O]=t.useState(),[a,g]=t.useState(),[m,D]=t.useState(!1),[B,c]=t.useState(),[C,X]=t.useState(),[U,ne]=t.useState(),[Q,p]=t.useState(!1),[re,se]=t.useState(),{onHeaderMenuClick:Y,onHeaderIndicatorClick:ee,getCellContent:x,onColumnMoved:N,onColumnResize:R,onColumnResizeStart:P,onColumnResizeEnd:W,gridRef:j,maxColumnWidth:M,minColumnWidth:z,onRowMoved:F,lockColumns:Z,onColumnProposeMove:I,onMouseDown:_,onMouseUp:A,onItemHovered:te,onDragStart:n,canvasRef:y}=e,G=(R??W??P)!==void 0,{columns:d,selection:l}=e,i=l.columns,S=t.useCallback(r=>{const[h,k]=r.location;s!==void 0&&a!==h&&h>=Z?(D(!0),g(h)):C!==void 0&&k!==void 0?(p(!0),ne(Math.max(0,k))):o===void 0&&!m&&!Q&&(te==null||te(r))},[s,C,a,te,Z,o,m,Q]),L=N!==void 0,q=t.useCallback(r=>{var h;if(r.button===0){const[k,w]=r.location;if(r.kind==="out-of-bounds"&&r.isEdge&&G){const T=(h=j==null?void 0:j.current)==null?void 0:h.getBounds(d.length-1,-1);T!==void 0&&(v(T.x),b(d.length-1))}else if(r.kind==="header"&&k>=Z){const T=y==null?void 0:y.current;if(r.isEdge&&G&&T){v(r.bounds.x),b(k);const de=T.getBoundingClientRect().width/T.offsetWidth,ie=r.bounds.width/de;P==null||P(d[k],ie,k,ie+(d[k].growOffset??0))}else r.kind==="header"&&L&&(c(r.bounds.x),O(k))}else r.kind==="cell"&&Z>0&&k===0&&w!==void 0&&F!==void 0&&(se(r.bounds.y),X(w))}_==null||_(r)},[_,G,Z,F,j,d,L,P,y]),K=t.useCallback((r,h)=>{m||Q||Y==null||Y(r,h)},[m,Q,Y]),J=t.useCallback((r,h)=>{m||Q||ee==null||ee(r,h)},[m,Q,ee]),E=t.useRef(-1),oe=t.useCallback(()=>{E.current=-1,X(void 0),ne(void 0),se(void 0),p(!1),O(void 0),g(void 0),c(void 0),D(!1),b(void 0),v(void 0)},[]),f=t.useCallback((r,h)=>{if(r.button===0){if(o!==void 0){if((i==null?void 0:i.hasIndex(o))===!0)for(const w of i){if(w===o)continue;const T=d[w],V=ce(T,E.current,z,M);R==null||R(T,V,w,V+(T.growOffset??0))}const k=ce(d[o],E.current,z,M);if(W==null||W(d[o],k,o,k+(d[o].growOffset??0)),i.hasIndex(o))for(const w of i){if(w===o)continue;const T=d[w],V=ce(T,E.current,z,M);W==null||W(T,V,w,V+(T.growOffset??0))}}oe(),s!==void 0&&a!==void 0&&(I==null?void 0:I(s,a))!==!1&&(N==null||N(s,a)),C!==void 0&&U!==void 0&&(F==null||F(C,U))}A==null||A(r,h)},[A,o,s,a,C,U,i,W,d,z,M,R,N,F,oe,I]),H=t.useMemo(()=>{if(!(s===void 0||a===void 0)&&s!==a&&(I==null?void 0:I(s,a))!==!1)return{src:s,dest:a}},[s,a,I]),$=t.useCallback(r=>{const h=y==null?void 0:y.current;if(s!==void 0&&B!==void 0)Math.abs(r.clientX-B)>20&&D(!0);else if(C!==void 0&&re!==void 0)Math.abs(r.clientY-re)>20&&p(!0);else if(o!==void 0&&u!==void 0&&h){const w=h.getBoundingClientRect().width/h.offsetWidth,T=(r.clientX-u)/w,V=d[o],de=ce(V,T,z,M);if(R==null||R(V,de,o,de+(V.growOffset??0)),E.current=T,(i==null?void 0:i.first())===o)for(const ie of i){if(ie===o)continue;const ue=d[ie],fe=ce(ue,E.current,z,M);R==null||R(ue,fe,ie,fe+(ue.growOffset??0))}}},[s,B,C,re,o,u,d,z,M,R,i,y]),le=t.useCallback((r,h)=>{if(C===void 0||U===void 0)return x(r,h);let[k,w]=r;return w===U?w=C:(w>U&&(w-=1),w>=C&&(w+=1)),x([k,w],h)},[C,U,x]),ae=t.useCallback(r=>{n==null||n(r),r.defaultPrevented()||oe()},[oe,n]);return t.createElement(ve,{accessibilityHeight:e.accessibilityHeight,canvasRef:e.canvasRef,cellXOffset:e.cellXOffset,cellYOffset:e.cellYOffset,columns:e.columns,disabledRows:e.disabledRows,drawFocusRing:e.drawFocusRing,drawHeader:e.drawHeader,drawCell:e.drawCell,enableGroups:e.enableGroups,eventTargetRef:e.eventTargetRef,experimental:e.experimental,fillHandle:e.fillHandle,firstColAccessible:e.firstColAccessible,fixedShadowX:e.fixedShadowX,fixedShadowY:e.fixedShadowY,freezeColumns:e.freezeColumns,getCellRenderer:e.getCellRenderer,getGroupDetails:e.getGroupDetails,getRowThemeOverride:e.getRowThemeOverride,groupHeaderHeight:e.groupHeaderHeight,headerHeight:e.headerHeight,headerIcons:e.headerIcons,height:e.height,highlightRegions:e.highlightRegions,imageWindowLoader:e.imageWindowLoader,resizeColumn:o,isDraggable:e.isDraggable,isFilling:e.isFilling,isFocused:e.isFocused,onCanvasBlur:e.onCanvasBlur,onCanvasFocused:e.onCanvasFocused,onCellFocused:e.onCellFocused,onContextMenu:e.onContextMenu,onDragEnd:e.onDragEnd,onDragLeave:e.onDragLeave,onDragOverCell:e.onDragOverCell,onDrop:e.onDrop,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,onMouseMove:e.onMouseMove,prelightCells:e.prelightCells,rowHeight:e.rowHeight,rows:e.rows,selection:e.selection,smoothScrollX:e.smoothScrollX,smoothScrollY:e.smoothScrollY,theme:e.theme,freezeTrailingRows:e.freezeTrailingRows,hasAppendRow:e.hasAppendRow,translateX:e.translateX,translateY:e.translateY,resizeIndicator:e.resizeIndicator,verticalBorder:e.verticalBorder,width:e.width,getCellContent:le,isResizing:o!==void 0,onHeaderMenuClick:K,onHeaderIndicatorClick:J,isDragging:m,onItemHovered:S,onDragStart:ae,onMouseDown:q,allowResize:G,onMouseUp:f,dragAndDropState:H,onMouseMoveRaw:$,ref:j})};function Re(e){const u=t.useRef(null),[v,o]=t.useState({width:e==null?void 0:e[0],height:e==null?void 0:e[1]});return t.useLayoutEffect(()=>{const b=O=>{for(const a of O){const{width:g,height:m}=a&&a.contentRect||{};o(D=>D.width===g&&D.height===m?D:{width:g,height:m})}},s=new window.ResizeObserver(b);return u.current&&s.observe(u.current,void 0),()=>{s.disconnect()}},[u.current]),{ref:u,...v}}const Se=(e,u,v)=>{const o=t.useRef(null),b=t.useRef(null),s=t.useRef(null),O=t.useRef(0),a=t.useRef(u);a.current=u;const g=v.current;t.useEffect(()=>{const m=()=>{var c,C;if(b.current===!1&&g!==null){const X=[g.scrollLeft,g.scrollTop];if(((c=s.current)==null?void 0:c[0])===X[0]&&((C=s.current)==null?void 0:C[1])===X[1])if(O.current>10){s.current=null,b.current=null;return}else O.current++;else O.current=0,a.current(X[0],X[1]),s.current=X;o.current=window.setTimeout(m,8.333333333333334)}},D=()=>{b.current=!0,s.current=null,o.current!==null&&(window.clearTimeout(o.current),o.current=null)},B=c=>{c.touches.length===0&&(b.current=!1,O.current=0,o.current=window.setTimeout(m,8.333333333333334))};if(e&&g!==null){const c=g;return c.addEventListener("touchstart",D),c.addEventListener("touchend",B),()=>{c.removeEventListener("touchstart",D),c.removeEventListener("touchend",B),o.current!==null&&window.clearTimeout(o.current)}}},[e,g])},be=()=>e=>e.isSafari?"scroll":"auto",De=me("div")({name:"ScrollRegionStyle",class:"sj2f20c",propsAsIs:!1,vars:{"sj2f20c-0":[be()]}});function ye(e){const[u,v]=t.useState(!1),o=typeof window>"u"?null:window,b=t.useRef(0);return ge("touchstart",t.useCallback(()=>{window.clearTimeout(b.current),v(!0)},[]),o,!0,!1),ge("touchend",t.useCallback(s=>{s.touches.length===0&&(b.current=window.setTimeout(()=>v(!1),e))},[e]),o,!0,!1),u}const He=e=>{var G,d;const{children:u,clientHeight:v,scrollHeight:o,scrollWidth:b,update:s,draggable:O,className:a,preventDiagonalScrolling:g=!1,paddingBottom:m=0,paddingRight:D=0,rightElement:B,rightElementProps:c,kineticScrollPerfHack:C=!1,scrollRef:X,initialSize:U}=e,ne=[],Q=(c==null?void 0:c.sticky)??!1,p=(c==null?void 0:c.fill)??!1,re=t.useRef(0),se=t.useRef(0),Y=t.useRef(null),ee=typeof window>"u"?1:window.devicePixelRatio,x=t.useRef({scrollLeft:0,scrollTop:0,lockDirection:void 0}),N=t.useRef(null),R=ye(200),[P,W]=t.useState(!0),j=t.useRef(0);t.useLayoutEffect(()=>{if(!P||R||x.current.lockDirection===void 0)return;const l=Y.current;if(l===null)return;const[i,S]=x.current.lockDirection;i!==void 0?l.scrollLeft=i:S!==void 0&&(l.scrollTop=S),x.current.lockDirection=void 0},[R,P]);const M=t.useCallback((l,i)=>{var ae;const S=Y.current;if(S===null)return;i=i??S.scrollTop,l=l??S.scrollLeft;const L=x.current.scrollTop,q=x.current.scrollLeft,K=l-q,J=i-L;R&&K!==0&&J!==0&&(Math.abs(K)>3||Math.abs(J)>3)&&g&&x.current.lockDirection===void 0&&(x.current.lockDirection=Math.abs(K)<Math.abs(J)?[q,void 0]:[void 0,L]);const E=x.current.lockDirection;l=(E==null?void 0:E[0])??l,i=(E==null?void 0:E[1])??i,x.current.scrollLeft=l,x.current.scrollTop=i;const oe=S.clientWidth,f=S.clientHeight,H=i,$=se.current-H,le=S.scrollHeight-f;if(se.current=H,le>0&&(Math.abs($)>2e3||H===0||H===le)&&o>S.scrollHeight+5){const r=H/le,h=(o-f)*r;re.current=h-H}E!==void 0&&(window.clearTimeout(j.current),W(!1),j.current=window.setTimeout(()=>W(!0),200)),s({x:l,y:H+re.current,width:oe-D,height:f-m,paddingRight:((ae=N.current)==null?void 0:ae.clientWidth)??0})},[m,D,o,s,g,R]);Se(C&&he.value,M,Y);const z=t.useRef(M);z.current=M;const F=t.useRef(),Z=t.useRef(!1);t.useLayoutEffect(()=>{Z.current?M():Z.current=!0},[M,m,D]);const I=t.useCallback(l=>{Y.current=l,X!==void 0&&(X.current=l)},[X]);let _=0,A=0;for(ne.push(t.createElement("div",{key:_++,style:{width:b,height:0}}));A<o;){const l=Math.min(5e6,o-A);ne.push(t.createElement("div",{key:_++,style:{width:0,height:l}})),A+=l}const{ref:te,width:n,height:y}=Re(U);return typeof window<"u"&&(((G=F.current)==null?void 0:G.height)!==y||((d=F.current)==null?void 0:d.width)!==n)&&(window.setTimeout(()=>z.current(),0),F.current={width:n,height:y}),(n??0)===0||(y??0)===0?t.createElement("div",{ref:te}):t.createElement("div",{ref:te},t.createElement(De,{isSafari:he.value},t.createElement("div",{className:"dvn-underlay"},u),t.createElement("div",{ref:I,style:F.current,draggable:O,onDragStart:l=>{O||(l.stopPropagation(),l.preventDefault())},className:"dvn-scroller "+(a??""),onScroll:()=>M()},t.createElement("div",{className:"dvn-scroll-inner"+(B===void 0?" dvn-hidden":"")},t.createElement("div",{className:"dvn-stack"},ne),B!==void 0&&t.createElement(t.Fragment,null,!p&&t.createElement("div",{className:"dvn-spacer"}),t.createElement("div",{ref:N,style:{height:y,maxHeight:v-Math.ceil(ee%1),position:"sticky",top:0,paddingLeft:1,marginBottom:-40,marginRight:D,flexGrow:p?1:void 0,right:Q?D??0:void 0,pointerEvents:"auto"}},B))))))},Te=e=>{const{columns:u,rows:v,rowHeight:o,headerHeight:b,groupHeaderHeight:s,enableGroups:O,freezeColumns:a,experimental:g,nonGrowWidth:m,clientSize:D,className:B,onVisibleRegionChanged:c,scrollRef:C,preventDiagonalScrolling:X,rightElement:U,rightElementProps:ne,overscrollX:Q,overscrollY:p,initialSize:re,smoothScrollX:se=!1,smoothScrollY:Y=!1,isDraggable:ee}=e,{paddingRight:x,paddingBottom:N}=g??{},[R,P]=D,W=t.useRef(),j=t.useRef(),M=t.useRef(),z=t.useRef(),F=typeof a=="number"?a:a[0],Z=m+Math.max(0,Q??0);let I=O?b+s:b;if(typeof o=="number")I+=v*o;else for(let n=0;n<v;n++)I+=o(n);p!==void 0&&(I+=p);const _=t.useRef(),A=t.useCallback(()=>{var E,oe;if(_.current===void 0)return;const n={..._.current};let y=0,G=n.x<0?-n.x:0,d=0,l=0;n.x=n.x<0?0:n.x;let i=0;for(let f=0;f<F;f++)i+=u[f].width;for(const f of u){const H=y-i;if(n.x>=H+f.width)y+=f.width,l++,d++;else if(n.x>H)y+=f.width,se?G+=H-n.x:l++,d++;else if(n.x+n.width>H)y+=f.width,d++;else break}let S=0,L=0,q=0;if(typeof o=="number")Y?(L=Math.floor(n.y/o),S=L*o-n.y):L=Math.ceil(n.y/o),q=Math.ceil(n.height/o)+L,S<0&&q++;else{let f=0;for(let H=0;H<v;H++){const $=o(H),le=f+(Y?0:$/2);if(n.y>=f+$)f+=$,L++,q++;else if(n.y>le)f+=$,Y?S+=le-n.y:L++,q++;else if(n.y+n.height>$/2+f)f+=$,q++;else break}}const K={x:l,y:L,width:d-l,height:q-L},J=W.current;(J===void 0||J.y!==K.y||J.x!==K.x||J.height!==K.height||J.width!==K.width||j.current!==G||M.current!==S||n.width!==((E=z.current)==null?void 0:E[0])||n.height!==((oe=z.current)==null?void 0:oe[1]))&&(c==null||c(K,n.width,n.height,n.paddingRight??0,G,S),W.current=K,j.current=G,M.current=S,z.current=[n.width,n.height])},[u,o,v,c,F,se,Y]),te=t.useCallback(n=>{_.current=n,A()},[A]);return t.useEffect(()=>{A()},[A]),t.createElement(He,{scrollRef:C,className:B,kineticScrollPerfHack:g==null?void 0:g.kineticScrollPerfHack,preventDiagonalScrolling:X,draggable:ee===!0||typeof ee=="string",scrollWidth:Z+(x??0),scrollHeight:I+(N??0),clientHeight:P,rightElement:U,paddingBottom:N,paddingRight:x,rightElementProps:ne,update:te,initialSize:re},t.createElement(Ce,{eventTargetRef:C,width:R,height:P,accessibilityHeight:e.accessibilityHeight,canvasRef:e.canvasRef,cellXOffset:e.cellXOffset,cellYOffset:e.cellYOffset,columns:e.columns,disabledRows:e.disabledRows,enableGroups:e.enableGroups,fillHandle:e.fillHandle,firstColAccessible:e.firstColAccessible,fixedShadowX:e.fixedShadowX,fixedShadowY:e.fixedShadowY,freezeColumns:e.freezeColumns,getCellContent:e.getCellContent,getCellRenderer:e.getCellRenderer,getGroupDetails:e.getGroupDetails,getRowThemeOverride:e.getRowThemeOverride,groupHeaderHeight:e.groupHeaderHeight,headerHeight:e.headerHeight,highlightRegions:e.highlightRegions,imageWindowLoader:e.imageWindowLoader,isFilling:e.isFilling,isFocused:e.isFocused,lockColumns:e.lockColumns,maxColumnWidth:e.maxColumnWidth,minColumnWidth:e.minColumnWidth,onHeaderMenuClick:e.onHeaderMenuClick,onHeaderIndicatorClick:e.onHeaderIndicatorClick,onMouseMove:e.onMouseMove,prelightCells:e.prelightCells,rowHeight:e.rowHeight,rows:e.rows,selection:e.selection,theme:e.theme,freezeTrailingRows:e.freezeTrailingRows,hasAppendRow:e.hasAppendRow,translateX:e.translateX,translateY:e.translateY,onColumnProposeMove:e.onColumnProposeMove,verticalBorder:e.verticalBorder,drawFocusRing:e.drawFocusRing,drawHeader:e.drawHeader,drawCell:e.drawCell,experimental:e.experimental,gridRef:e.gridRef,headerIcons:e.headerIcons,isDraggable:e.isDraggable,onCanvasBlur:e.onCanvasBlur,onCanvasFocused:e.onCanvasFocused,onCellFocused:e.onCellFocused,onColumnMoved:e.onColumnMoved,onColumnResize:e.onColumnResize,onColumnResizeEnd:e.onColumnResizeEnd,onColumnResizeStart:e.onColumnResizeStart,onContextMenu:e.onContextMenu,onDragEnd:e.onDragEnd,onDragLeave:e.onDragLeave,onDragOverCell:e.onDragOverCell,onDragStart:e.onDragStart,onDrop:e.onDrop,onItemHovered:e.onItemHovered,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onRowMoved:e.onRowMoved,smoothScrollX:e.smoothScrollX,smoothScrollY:e.smoothScrollY,resizeIndicator:e.resizeIndicator}))};export{Te as G};
