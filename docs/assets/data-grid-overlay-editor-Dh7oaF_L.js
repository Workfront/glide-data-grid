import{r}from"./iframe-u-uZSGaK.js";import{r as $}from"./index-DAIvD5fl.js";import{C as Q}from"./data-editor-all-D0pAsWhk.js";import{H as P,v as U,J as Z,T as ee,O as te}from"./image-window-loader-BuZ8WPKd.js";import{s as re}from"./marked.esm-DMz2Pe0E.js";import"./throttle-BIWfclFY.js";import"./flatten-CPDsTVcy.js";import"./scrolling-data-grid-BQ2mQOi3.js";const se=()=>t=>t.targetX,ie=()=>t=>t.targetY,ne=()=>t=>t.targetWidth,oe=()=>t=>t.targetHeight,ae=()=>t=>t.targetY+10,le=()=>t=>Math.max(0,(t.targetHeight-28)/2),ce=re("div")({name:"DataGridOverlayEditorStyle",class:"d16c1ze1",propsAsIs:!1,vars:{"d16c1ze1-0":[ie(),"px"],"d16c1ze1-1":[se(),"px"],"d16c1ze1-2":[ne(),"px"],"d16c1ze1-3":[oe(),"px"],"d16c1ze1-4":[ae(),"px"],"d16c1ze1-5":[le(),"px"]}});function de(){const[t,n]=r.useState();return[t??void 0,n]}function ue(){const[t,n]=de(),[i,h]=r.useState(0),[p,C]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const o=new IntersectionObserver(a=>{a.length!==0&&C(a[0].isIntersecting)},{threshold:1});return o.observe(t),()=>o.disconnect()},[t]),r.useEffect(()=>{if(p||t===void 0)return;let o;const a=()=>{const{right:S}=t.getBoundingClientRect();h(m=>Math.min(m+window.innerWidth-S-10,0)),o=requestAnimationFrame(a)};return o=requestAnimationFrame(a),()=>{o!==void 0&&cancelAnimationFrame(o)}},[t,p]);const O=r.useMemo(()=>({transform:`translateX(${i}px)`}),[i]);return{ref:n,style:O}}const xe=t=>{const{target:n,content:i,onFinishEditing:h,forceEditMode:p,initialValue:C,imageEditorOverride:O,markdownDivCreateNode:o,highlight:a,className:S,theme:m,id:A,cell:k,bloom:u,portalElementRef:v,validateCell:l,getCellRenderer:w,provideEditor:y,isOutsideClick:N,customEventTarget:V}=t,[c,W]=r.useState(p?i:void 0),R=r.useRef(c??i);R.current=c??i;const[E,I]=r.useState(()=>l===void 0?!0:!(P(i)&&(l==null?void 0:l(k,i,R.current))===!1)),f=r.useCallback((e,s)=>{h(E?e:void 0,s)},[E,h]),Y=r.useCallback(e=>{if(l!==void 0&&e!==void 0&&P(e)){const s=l(k,e,R.current);s===!1?I(!1):(typeof s=="object"&&(e=s),I(!0))}W(e)},[k,l]),x=r.useRef(!1),g=r.useRef(void 0),j=r.useCallback(()=>{f(c,[0,0]),x.current=!0},[c,f]),K=r.useCallback((e,s)=>{f(e,s??g.current??[0,0]),x.current=!0},[f]),q=r.useCallback(async e=>{let s=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),g.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),g.current=[0,1],s=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),g.current=[e.shiftKey?-1:1,0],s=!0),window.setTimeout(()=>{!x.current&&g.current!==void 0&&(f(s?c:void 0,g.current),x.current=!0)},0)},[f,c]),D=c??i,[d,B]=r.useMemo(()=>{var s,X;if(U(i))return[];const e=y==null?void 0:y(i);return e!==void 0?[e,!1]:[(X=(s=w(i))==null?void 0:s.provideEditor)==null?void 0:X.call(s,i),!1]},[i,w,y]),{ref:L,style:J}=ue();let z=!0,T,_=!0,b;if(d!==void 0){z=d.disablePadding!==!0,_=d.disableStyling!==!0;const e=Z(d);e&&(b=d.styleOverride);const s=e?d.editor:d;T=r.createElement(s,{portalElementRef:v,isHighlighted:a,onChange:Y,value:D,initialValue:C,onFinishedEditing:K,validatedSelection:P(D)?D.selectionRange:void 0,forceEditMode:p,target:n,imageEditorOverride:O,markdownDivCreateNode:o,isValid:E,theme:m})}b={...b,...J};const H=(v==null?void 0:v.current)??document.getElementById("portal");if(H===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let F=_?"gdg-style":"gdg-unstyle";E||(F+=" gdg-invalid"),z&&(F+=" gdg-pad");const M=(u==null?void 0:u[0])??1,G=(u==null?void 0:u[1])??1;return $.createPortal(r.createElement(ee.Provider,{value:m},r.createElement(Q,{style:te(m),className:S,onClickOutside:j,isOutsideClick:N,customEventTarget:V},r.createElement(ce,{ref:L,id:A,className:F,style:b,as:B===!0?"label":void 0,targetX:n.x-M,targetY:n.y-G,targetWidth:n.width+M*2,targetHeight:n.height+G*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:q},T)))),H)};export{xe as default};
